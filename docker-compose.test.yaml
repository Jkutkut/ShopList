services:
  db:
    container_name: shoplist-db-test
    hostname: shoplist-db-test
    networks:
      - db-network-test
  auth:
    container_name: shoplist-auth-test
    build:
      context: ./backend/
      dockerfile: Dockerfile
      target: builder
    environment:
      DB_HOST: "shoplist-db-test"
      ENV_PATH: "/shoplist/.env.test"
    volumes:
      - cargo_registy:/root/.cargo/registry
      - .:/shoplist
    working_dir: /shoplist/backend
    entrypoint: cargo
    command: watch -- cargo test -p auth -- --test-threads=1
    networks:
      - db-network-test
      - auth-network-test
volumes:
  cargo_registy:
networks:
  db-network-test:
    driver: bridge
  auth-network-test:
    driver: bridge
