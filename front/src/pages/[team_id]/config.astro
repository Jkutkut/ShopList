---
import teamService, { client as teamServiceClient } from "../../api/versions/v1/teamService";
import ConfigTeamForm from "../../components/form/ConfigTeamForm";
import Debug from "../../layouts/debug.astro";
import { OPTIONS } from "../../mockup";
import { previousPageUrl } from "../../utils";

const { team_id } = Astro.params;

if (!team_id) {
  return Astro.redirect('/teams', 302);
}

teamServiceClient.addToken(Astro.cookies.get("jwt")!.value);
const result = await teamService.getTeam(team_id);
if (result.isErr()) {
  console.error("Unable to get team:", result.unwrapErr());
  return Astro.redirect("/teams");
}

const team = result.unwrap().data;
---
<Debug
  title=`Shoplist - ${team.name} configuration`
  description=`Configure the team ${team.name}`
  options={[
    { name: 'Back', url: previousPageUrl(Astro) },
    ...OPTIONS['config-team']
  ]}
>
  <ConfigTeamForm client:load team={team} />
</Debug>
